!function(a){"use strict";a.chart("hierarchy",{initialize:function(){var b=this;b.d3={},b.layers={},b.base.attr("width",b.base.node().parentElement.clientWidth),b.base.attr("height",b.base.node().parentElement.clientHeight),b.d3.zoom=a.behavior.zoom(),b.layers.base=b.base.append("g"),b.name(b._name||"name"),b.value(b._value||"value"),b.duration(b._duration||750),b.on("change:value",function(){b.d3.layout.value(function(a){return"_COUNT"===b._value?1:a[b._value]})}),b.walker=function(a,c,d){if(a){c(a);var e=d(a);if(e)for(var f=e.length,g=0;f>g;g++)b.walker(e[g],c,d)}}},transform:function(a){return a},name:function(a){return arguments.length?(this._name=a,this.trigger("change:name"),this.root&&this.draw(this.root),this):this._name},value:function(a){return arguments.length?(this._value=a,this.trigger("change:value"),this.root&&this.draw(this.root),this):this._value},duration:function(a){return arguments.length?(this._duration=a,this.trigger("change:duration"),this.root&&this.draw(this.root),this):this._duration},zoomable:function(b){function c(){d.layers.base.attr("transform","translate("+a.event.translate+") scale("+a.event.scale+")")}var d=this,e=b||[0,1/0];return d.base.call(d.d3.zoom.scaleExtent(e).on("zoom",c)),d},sort:function(b){var c=this;return c.d3.layout.sort("_ASC"===b?function(b,d){return a.ascending(b[c._name],d[c._name])}:"_DESC"===b?function(b,d){return a.descending(b[c._name],d[c._name])}:b),c}}),a.chart("hierarchy").extend("cluster-tree",{initialize:function(){var b=this,c=0;b.radius(b._radius||4.5),b._width=b.base.attr("width"),b._height=b.base.attr("height"),b.layers.links=b.layers.base.append("g").classed("links",!0),b.layers.nodes=b.layers.base.append("g").classed("nodes",!0),b.layer("nodes",b.layers.nodes,{dataBind:function(a){return this.selectAll(".node").data(a,function(a){return a._id||(a._id=++c)})},insert:function(){return this.append("g").classed("node",!0)},events:{enter:function(){this.append("circle").attr("r",0).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}),this.append("text").attr("dy",".35em").text(function(a){return a[b._name]}).style("fill-opacity",0),this.on("click",function(c){var d=this;setTimeout(function(){var a=parseInt(d.getAttribute("data-double"),10);a>0?d.setAttribute("data-double",a-1):b.trigger("singleClick",c)},300),a.event.stopPropagation()}).on("dblclick",function(c){this.setAttribute("data-double",2),b.trigger("doubleClick",c),a.event.stopPropagation()})},"merge:transition":function(){this.select("circle").attr("r",b._radius).style("stroke",function(a){return a.path?"brown":"steelblue"}).style("fill",function(a){return a.path&&!a.parent.path?"#E2A76F":a._children?"lightsteelblue":"#fff"}),this.select("text").style("fill-opacity",1)},"exit:transition":function(){this.duration(b._duration).remove(),this.select("circle").attr("r",0),this.select("text").style("fill-opacity",0)}}}),b.layer("links",b.layers.links,{dataBind:function(a){return this.selectAll(".link").data(b.d3.layout.links(a),function(a){return a.target._id})},insert:function(){return this.append("path").classed("link",!0)},events:{enter:function(){this.attr("d",function(){var a={x:b.source.x0,y:b.source.y0};return b.d3.diagonal({source:a,target:a})})},"merge:transition":function(){this.duration(b._duration).attr("d",b.d3.diagonal).attr("stroke",function(a){return a.source.path&&a.target.path?"#dd7b7b":"#ccc"}).style("stroke-width",function(a){return a.path?1:1.5})},"exit:transition":function(){this.duration(b._duration).attr("d",function(){var a={x:b.source.x,y:b.source.y};return b.d3.diagonal({source:a,target:a})}).remove()}}})},radius:function(a){return arguments.length?(this._radius="_COUNT"===a?function(a){return a._children?a._children.length:a.children?a.children.length:1}:a,this.trigger("change:radius"),this.root&&this.draw(this.root),this):this._radius},collapsible:function(a){function b(a){return a.children?(a._children=a.children,a.children=null):a._children&&(a.children=a._children,a._children=null),a}function c(a){a.children&&(a._children=a.children,a._children.forEach(c),a.children=null)}var d=this,e=a;return d.once("collapse:init",function(){void 0!==e&&d.walker(d.root,function(a){a.depth==e&&c(a)},function(a){return a.children&&a.children.length>0&&a.depth<e?a.children:a._children&&a._children.length>0&&a.depth<e?a._children:null})}),d.on("singleClick",function(a){a=b(a),d.trigger("transform:stash"),d.draw(a)}),d}}),a.chart("cluster-tree").extend("cluster-tree.cartesian",{initialize:function(){var b=this;b.margin(b._margin||{}),b.d3.diagonal=a.svg.diagonal().projection(function(a){return[a.y,a.x]}),b.layers.nodes.on("enter",function(){this.attr("transform",function(){return"translate("+b.source.y0+","+b.source.x0+")"}),this.select("text").attr("x",function(a){return a.children||a._children?-10:10}).attr("text-anchor",function(a){return a.children||a._children?"end":"start"})}),b.layers.nodes.on("merge:transition",function(){this.duration(b._duration).attr("transform",function(a){return"translate("+a.y+","+a.x+")"})}),b.layers.nodes.on("exit:transition",function(){this.attr("transform",function(){return"translate("+b.source.y+","+b.source.x+")"})}),b.on("change:margin",function(){b._width=b.base.attr("width")-b._margin.left-b._margin.right,b._height=b.base.attr("height")-b._margin.top-b._margin.bottom,b.base.attr("transform","translate("+b._margin.left+","+b._margin.top+")")})},transform:function(a){var b,c=this;return c.source=a,c.root||(c.root=a,c.root.x0=c._height/2,c.root.y0=0,b=c.d3.layout.size([c._height,c._width]).nodes(c.root),c.trigger("collapse:init")),b=c.d3.layout.nodes(c.root).reverse(),c.on("transform:stash",function(){b.forEach(function(a){a.x0=a.x,a.y0=a.y})}),b},margin:function(a){return arguments.length?(["top","right","bottom","left"].forEach(function(b){b in a&&(this[b]=a[b])},this._margin={top:0,right:0,bottom:0,left:0}),this.trigger("change:margin"),this.root&&this.draw(this.root),this):this._margin}}),a.chart("cluster-tree").extend("cluster-tree.radial",{initialize:function(){var b=this;b.diameter(b._diameter||Math.min(b._width,b._height)),b.d3.diagonal=a.svg.diagonal.radial().projection(function(a){return[a.y,a.x/180*Math.PI]}),b.d3.zoom.translate([b._diameter/2,b._diameter/2]),b.layers.base.attr("transform","translate("+b._diameter/2+","+b._diameter/2+")"),b.layers.nodes.on("enter",function(){this.attr("transform",function(){return"rotate("+(b.source.x0-90)+")translate("+b.source.y0+")"}),this.select("text").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?"translate(8)":"rotate(180)translate(-8)"})}),b.layers.nodes.on("merge:transition",function(){this.duration(b._duration).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"})}),b.layers.nodes.on("exit:transition",function(){this.attr("transform",function(){return"rotate("+(b.source.x-90)+")translate("+b.source.y+")"})})},transform:function(a){var b,c=this;return c.source=a,c.root||(c.root=a,c.root.x0=360,c.root.y0=0,b=c.d3.layout.size([360,c._diameter/4]).separation(function(a,b){return 0===a.depth?1:(a.parent==b.parent?1:2)/a.depth}).nodes(c.root),c.trigger("collapse:init")),b=c.d3.layout.nodes(c.root).reverse(),c.on("transform:stash",function(){b.forEach(function(a){a.x0=a.x,a.y0=a.y})}),b},diameter:function(a){return arguments.length?(this._diameter=a,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this._diameter}}),a.chart("cluster-tree.cartesian").extend("cluster.cartesian",{initialize:function(){this.d3.layout=a.layout.cluster()}}),a.chart("cluster-tree.radial").extend("cluster.radial",{initialize:function(){this.d3.layout=a.layout.cluster()}}),a.chart("hierarchy").extend("pack.flattened",{initialize:function(){var b=this;b.d3.layout=a.layout.pack(),b._width=b.base.attr("width"),b._height=b.base.attr("height"),b.flatten(b._flatten||null),b.formats(b._formats||{}),b.diameter(b._diameter||Math.min(b._width,b._height)),b.d3.zoom.translate([(b._width-b._diameter)/2,(b._height-b._diameter)/2]),b.layers.base.attr("transform","translate("+(b._width-b._diameter)/2+","+(b._height-b._diameter)/2+")"),b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".node").data(a.filter(function(a){return!a.children}))},insert:function(){return this.append("g")},events:{enter:function(){this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("circle").attr("r",function(a){return a.r}).style("stroke","#aaa").style("fill",b._formats.fill),this.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(a){return a[b._name].substring(0,a.r/3)}),this.append("title").text(b._formats.title),this.on("click",function(c){var d=this;setTimeout(function(){var a=parseInt(d.getAttribute("data-double"),10);a>0?d.setAttribute("data-double",a-1):b.trigger("singleClick",c)},300),a.event.stopPropagation()}).on("dblclick",function(c){this.setAttribute("data-double",2),b.trigger("doubleClick",c),a.event.stopPropagation()})}}}),b.on("change:diameter",function(){b.layers.base.attr("transform","translate("+(b._width-b._diameter)/2+","+(b._height-b._diameter)/2+")")})},transform:function(a){var b=this;return b.root=a,b.d3.layout.size([b._diameter,b._diameter]).sort(null).padding(1.5).nodes(b._flatten?b._flatten(a):a)},diameter:function(a){return arguments.length?(this._diameter=a-10,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this._diameter},flatten:function(a){return arguments.length?(this._flatten=a,this.trigger("change:flatten"),this.root&&this.draw(this.root),this):this._flatten},formats:function(b){if(!arguments.length)return this._formats;var c=this,d=a.scale.category20c();return["title","fill"].forEach(function(c){c in b&&(this[c]=a.functor(b[c]))},this._formats={title:function(a){return a[c._value]},fill:function(a){return d(a[c._name])}}),c.trigger("change:formats"),c.root&&c.draw(c.root),c}}),a.chart("hierarchy").extend("pack.nested",{initialize:function(){var b=this;b.d3.layout=a.layout.pack(),b._width=b.base.attr("width"),b._height=b.base.attr("height"),b.diameter(b._diameter||Math.min(b._width,b._height)),b.d3.zoom.translate([(b._width-b._diameter)/2,(b._height-b._diameter)/2]),b.layers.base.attr("transform","translate("+(b._width-b._diameter)/2+","+(b._height-b._diameter)/2+")"),b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".node").data(a)},insert:function(){return this.append("g")},events:{enter:function(){this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("circle").attr("r",function(a){return a.r}),this.append("text").attr("dy",".3em").style("text-anchor","middle"),this.on("click",function(c){var d=this;setTimeout(function(){var a=parseInt(d.getAttribute("data-double"),10);a>0?d.setAttribute("data-double",a-1):b.trigger("singleClick",c)},300),a.event.stopPropagation()}).on("dblclick",function(c){this.setAttribute("data-double",2),b.trigger("doubleClick",c),a.event.stopPropagation()})},merge:function(){this.attr("class",function(a){return a.children?"node parent":"node child"}),this.select("text").style("opacity",function(a){return a.r>20?1:0}).text(function(a){return a[b._name]})}}}),b.on("change:diameter",function(){b.layers.base.attr("transform","translate("+(b._width-b._diameter)/2+","+(b._height-b._diameter)/2+")")})},transform:function(a){var b=this;return b.root=a,b.d3.layout.size([b._diameter,b._diameter]).nodes(a)},diameter:function(a){return arguments.length?(this._diameter=a-10,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this._diameter},collapsible:function(){function b(a){var b=d._diameter/a.r/2;e.domain([a.x-a.r,a.x+a.r]),f.domain([a.y-a.r,a.y+a.r]);var g=d.layers.base.transition().duration(d._duration);g.selectAll(".node").attr("transform",function(a){return"translate("+e(a.x)+","+f(a.y)+")"}),g.selectAll("circle").attr("r",function(a){return b*a.r}),g.selectAll("text").style("opacity",function(a){return b*a.r>20?1:0}),c=a}var c,d=this,e=a.scale.linear().range([0,d._diameter]),f=a.scale.linear().range([0,d._diameter]);return d.layers.base.on("merge",function(){c=d.root,d.on("singleClick",function(a){b(c==a?d.root:a)})}),d.base.on("click",function(){b(d.root)}),d}}),a.chart("hierarchy").extend("partition.arc",{initialize:function(){var b=this;b.d3.layout=a.layout.partition(),b._width=b.base.attr("width"),b._height=b.base.attr("height"),b.diameter(b._diameter||Math.min(b._width,b._height)),b.d3.color=a.scale.category20c(),b.d3.x=a.scale.linear().range([0,2*Math.PI]),b.d3.y=a.scale.sqrt().range([0,b._diameter/2]),b.d3.arc=a.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,b.d3.x(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,b.d3.x(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,b.d3.y(a.y))}).outerRadius(function(a){return Math.max(0,b.d3.y(a.y+a.dy))}),b.d3.zoom.translate([b.base.attr("width")/2,b.base.attr("height")/2]),b.layers.base.attr("transform","translate("+b.base.attr("width")/2+","+b.base.attr("height")/2+")"),b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll("path").data(a)},insert:function(){return this.append("path")},events:{enter:function(){this.attr("d",b.d3.arc).style("fill",function(a){return b.d3.color((a.children?a:a.parent)[b._name])}),this.on("click",function(c){var d=this;setTimeout(function(){var a=parseInt(d.getAttribute("data-double"),10);a>0?d.setAttribute("data-double",a-1):b.trigger("singleClick",c)},300),a.event.stopPropagation()}).on("dblclick",function(c){this.setAttribute("data-double",2),b.trigger("doubleClick",c),a.event.stopPropagation()})}}}),b.on("change:radius",function(){b.layers.paths.attr("transform","translate("+b.base.attr("width")/2+","+b.base.attr("height")/2+")"),b.d3.y=a.scale.sqrt().range([0,b._diameter/2])})},transform:function(a){var b=this;return b.root=a,b.d3.layout.nodes(a)},diameter:function(a){return arguments.length?(this._diameter=a-10,this.trigger("change:radius"),this.root&&this.draw(this.root),this):this._diameter},collapsible:function(){function b(b){var d=a.interpolate(c.d3.x.domain(),[b.x,b.x+b.dx]),e=a.interpolate(c.d3.y.domain(),[b.y,1]),f=a.interpolate(c.d3.y.range(),[b.y?20:0,c._diameter/2]);return function(a,b){return b?function(){return c.d3.arc(a)}:function(b){return c.d3.x.domain(d(b)),c.d3.y.domain(e(b)).range(f(b)),c.d3.arc(a)}}}var c=this;return c.layers.base.on("merge",function(){var a=this;c.on("singleClick",function(d){a.transition().duration(c._duration).attrTween("d",b(d))})}),c}}),a.chart("hierarchy").extend("partition.rectangle",{initialize:function(){var b=this;b.d3.layout=a.layout.partition(),b._width=b.base.attr("width"),b._height=b.base.attr("height");var c=a.scale.linear().range([0,b._width]),d=a.scale.linear().range([0,b._height]);b.d3.transform=function(a,b){return"translate(8,"+a.dx*b/2+")"},b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".partition").data(a)},insert:function(){return this.append("g").classed("partition",!0).attr("transform",function(a){return"translate("+c(a.y)+","+d(a.x)+")"})},events:{enter:function(){var c=b._width/b.root.dx,d=b._height/1;this.append("rect").attr("class",function(a){return a.children?"parent":"child"}).attr("width",b.root.dy*c).attr("height",function(a){return a.dx*d}),this.append("text").attr("transform",function(a){return b.d3.transform(a,d)}).attr("dy",".35em").style("opacity",function(a){return a.dx*d>12?1:0}).text(function(a){return a[b._name]}),this.on("click",function(c){var d=this;setTimeout(function(){var a=parseInt(d.getAttribute("data-double"),10);a>0?d.setAttribute("data-double",a-1):b.trigger("singleClick",c)},300),a.event.stopPropagation()}).on("dblclick",function(c){this.setAttribute("data-double",2),b.trigger("doubleClick",c),a.event.stopPropagation()})}}})},transform:function(a){var b=this;return b.root=a,b.d3.layout.nodes(a)},collapsible:function(){function b(a){var b=(a.y?d._width-40:d._width)/(1-a.y),g=d._height/a.dx;e.domain([a.y,1]).range([a.y?40:0,d._width]),f.domain([a.x,a.x+a.dx]);var h=d.layers.base.transition().duration(d._duration);h.selectAll(".partition").attr("transform",function(a){return"translate("+e(a.y)+","+f(a.x)+")"}),h.selectAll("rect").attr("width",a.dy*b).attr("height",function(a){return a.dx*g}),h.selectAll("text").attr("transform",function(a){return d.d3.transform(a,g)}).style("opacity",function(a){return a.dx*g>12?1:0}),c=a}var c,d=this,e=a.scale.linear(),f=a.scale.linear().range([0,d._height]);return d.layers.base.on("merge",function(){c=d.root,d.on("singleClick",function(a){b(c==a?d.root:a)})}),d.base.on("click",function(){b(d.root)}),d}}),a.chart("cluster-tree.cartesian").extend("tree.cartesian",{initialize:function(){this.d3.layout=a.layout.tree()}}),a.chart("cluster-tree.radial").extend("tree.radial",{initialize:function(){this.d3.layout=a.layout.tree()}}),a.chart("hierarchy").extend("treemap",{initialize:function(){var b=this;b.d3.layout=a.layout.treemap(),b._width=b.base.attr("width"),b._height=b.base.attr("height");var c=a.scale.category20c();b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".cell").data(a)},insert:function(){return this.append("g").classed("cell",!0).attr("transform",function(a){return"translate("+a.x+","+a.y+")"})},events:{enter:function(){this.append("rect").attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("fill",function(a){return a.parent?c(a.parent[b._name]):null}),this.append("text").attr("x",function(a){return a.dx/2}).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(a){return a.children?null:a[b._name]}).style("opacity",function(a){return a.w=this.getComputedTextLength(),a.dx>a.w?1:0}),this.on("click",function(c){var d=this;setTimeout(function(){var a=parseInt(d.getAttribute("data-double"),10);a>0?d.setAttribute("data-double",a-1):b.trigger("singleClick",c)},300),a.event.stopPropagation()}).on("dblclick",function(c){this.setAttribute("data-double",2),b.trigger("doubleClick",c),a.event.stopPropagation()})}}})},transform:function(a){var b=this;return b.root=a,b.d3.layout.round(!1).size([b._width,b._height]).sticky(!0).nodes(a)},collapsible:function(){function b(a){var b=d._width/a.dx,g=d._height/a.dy;e.domain([a.x,a.x+a.dx]),f.domain([a.y,a.y+a.dy]);var h=d.layers.base.transition().duration(d._duration);h.selectAll(".cell").attr("transform",function(a){return"translate("+e(a.x)+","+f(a.y)+")"}),h.selectAll("rect").attr("width",function(a){return b*a.dx}).attr("height",function(a){return g*a.dy}),h.selectAll("text").attr("x",function(a){return b*a.dx/2}).attr("y",function(a){return g*a.dy/2}).style("opacity",function(a){return b*a.dx>a.w?1:0}),c=a}var c,d=this,e=a.scale.linear().range([0,d._width]),f=a.scale.linear().range([0,d._height]);return d.layers.base.on("merge",function(){c=d.root,d.on("singleClick",function(a){b(c==a.parent?d.root:a.parent)})}),d.base.on("click",function(){b(d.root)}),d}})}(window.d3);