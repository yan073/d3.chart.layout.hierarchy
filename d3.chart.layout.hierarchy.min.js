!function(a){"use strict";a.chart("hierarchy",{initialize:function(){var b=this;b.features={},b.d3={},b.layers={},b.base.attr("width",b.base.node().parentElement.clientWidth),b.base.attr("height",b.base.node().parentElement.clientHeight),b.features.width=b.base.attr("width"),b.features.height=b.base.attr("height"),b.d3.colorScale=b.features.colors?a.scale.ordinal().range(b.features.colors):a.scale.category20c(),b.d3.zoom=a.behavior.zoom(),b.layers.base=b.base.append("g"),b.name(b.features.name||"name"),b.value(b.features.value||"value"),b.duration(b.features.duration||750),b.on("change:value",function(){b.d3.layout.value(function(a){return"_COUNT"===b.features.value?1:a[b.features.value]})}),b.on("change:colors",function(){b.d3.colorScale=a.scale.ordinal().range(b.features.colors)}),b._walker=function(a,c,d){if(a){c(a);var e=d(a);if(e)for(var f=e.length,g=0;f>g;g++)b._walker(e[g],c,d)}},b._initNode=function(a){a.classed("leaf",function(a){return a.isLeaf}).classed("non-leaf",function(a){return!a.isLeaf})}},transform:function(a){return this._walker(this.root,function(a){a.isLeaf=!a.children&&!a._children},function(a){return a.children&&a.children.length>0?a.children:a._children&&a._children.length>0?a._children:null}),a},name:function(a){return arguments.length?(this.features.name=a,this.trigger("change:name"),this.root&&this.draw(this.root),this):this.features.name},value:function(a){return arguments.length?(this.features.value=a,this.trigger("change:value"),this.root&&this.draw(this.root),this):this.features.value},colors:function(a){return arguments.length?(this.features.colors=a,this.trigger("change:colors"),this.root&&this.draw(this.root),this):this.features.colors},duration:function(a){return arguments.length?(this.features.duration=a,this.trigger("change:duration"),this.root&&this.draw(this.root),this):this.features.duration},sortable:function(b){var c=this;return c.d3.layout.sort("_ASC"===b?function(b,d){return a.ascending(b[c.features.name],d[c.features.name])}:"_DESC"===b?function(b,d){return a.descending(b[c.features.name],d[c.features.name])}:b),c},zoomable:function(b){function c(){d.layers.base.attr("transform","translate("+a.event.translate+") scale("+a.event.scale+")")}var d=this,e=b||[0,1/0];return d.base.call(d.d3.zoom.scaleExtent(e).on("zoom",c)),d}}),a.chart("hierarchy").extend("cluster-tree",{initialize:function(){var a=this,b=0;a.radius(a.features.radius||4.5),a.levelGap(a.features.levelGap||"auto"),a.layers.links=a.layers.base.append("g").classed("links",!0),a.layers.nodes=a.layers.base.append("g").classed("nodes",!0),a.layer("nodes",a.layers.nodes,{dataBind:function(a){return this.selectAll(".node").data(a,function(a){return a._id||(a._id=++b)})},insert:function(){return this.append("g").classed("node",!0)},events:{enter:function(){a._initNode(this),this.append("circle").attr("r",0),this.append("text").attr("dy",".35em").text(function(b){return b[a.features.name]}).style("fill-opacity",0),this.on("click",function(b){a.trigger("node:click",b)})},merge:function(){a._initNode(this)},"merge:transition":function(){this.select("circle").attr().attr("r",a.features.radius),this.select("text").style("fill-opacity",1)},"exit:transition":function(){this.duration(a.features.duration).remove(),this.select("circle").attr("r",0),this.select("text").style("fill-opacity",0)}}}),a.layer("links",a.layers.links,{dataBind:function(b){return this.selectAll(".link").data(a.d3.layout.links(b),function(a){return a.target._id})},insert:function(){return this.append("path").classed("link",!0)},events:{enter:function(){this.attr("d",function(){var b={x:a.source.x0,y:a.source.y0};return a.d3.diagonal({source:b,target:b})})},"merge:transition":function(){this.duration(a.features.duration).attr("d",a.d3.diagonal)},"exit:transition":function(){this.duration(a.features.duration).attr("d",function(){var b={x:a.source.x,y:a.source.y};return a.d3.diagonal({source:b,target:b})}).remove()}}})},transform:function(a){var b=this;return b.features.levelGap&&"auto"!==b.features.levelGap&&a.forEach(function(a){a.y=a.depth*b.features.levelGap}),a},radius:function(a){return arguments.length?(this.features.radius="_COUNT"===a?function(a){return a._children?a._children.length:a.children?a.children.length:1}:a,this.trigger("change:radius"),this.root&&this.draw(this.root),this):this.features.radius},levelGap:function(a){return arguments.length?(this.features.levelGap=a,this.trigger("change:levelGap"),this.root&&this.draw(this.root),this):this.features.levelGap},collapsible:function(a){function b(a){return a.children?(a._children=a.children,a.children=null):a._children&&(a.children=a._children,a._children=null),a}function c(a){a.children&&(a._children=a.children,a._children.forEach(c),a.children=null)}var d=this,e=a;return d.once("collapse:init",function(){void 0!==e&&d._walker(d.root,function(a){a.depth==e&&c(a)},function(a){return a.children&&a.children.length>0&&a.depth<e?a.children:a._children&&a._children.length>0&&a.depth<e?a._children:null})}),d.on("node:click",function(a){a=b(a),d.trigger("transform:stash"),d.draw(a)}),d}}),a.chart("cluster-tree").extend("cluster-tree.cartesian",{initialize:function(){var b=this;b.margin(b.features.margin||{}),b.d3.diagonal=a.svg.diagonal().projection(function(a){return[a.y,a.x]}),b.layers.nodes.on("enter",function(){this.attr("transform",function(){return"translate("+b.source.y0+","+b.source.x0+")"}),this.select("text").attr("x",function(a){return a.isLeaf?10:-10}).attr("text-anchor",function(a){return a.isLeaf?"start":"end"})}),b.layers.nodes.on("merge:transition",function(){this.duration(b.features.duration).attr("transform",function(a){return"translate("+a.y+","+a.x+")"})}),b.layers.nodes.on("exit:transition",function(){this.attr("transform",function(){return"translate("+b.source.y+","+b.source.x+")"})}),b.on("change:margin",function(){b.features.width=b.base.attr("width")-b.features.margin.left-b.features.margin.right,b.features.height=b.base.attr("height")-b.features.margin.top-b.features.margin.bottom,b.base.attr("transform","translate("+b.features.margin.left+","+b.features.margin.top+")")})},transform:function(a){var b,c=this;return c.source=a,c.root||(c.root=a,c.root.x0=c.features.height/2,c.root.y0=0,b=c.d3.layout.size([c.features.height,c.features.width]).nodes(c.root),c.trigger("collapse:init")),b=c.d3.layout.nodes(c.root).reverse(),c.on("transform:stash",function(){b.forEach(function(a){a.x0=a.x,a.y0=a.y})}),b},margin:function(a){return arguments.length?(["top","right","bottom","left"].forEach(function(b){b in a&&(this[b]=a[b])},this.features.margin={top:0,right:0,bottom:0,left:0}),this.trigger("change:margin"),this.root&&this.draw(this.root),this):this.features.margin}}),a.chart("cluster-tree").extend("cluster-tree.radial",{initialize:function(){var b=this;b.diameter(b.features.diameter||Math.min(b.features.width,b.features.height)),b.d3.diagonal=a.svg.diagonal.radial().projection(function(a){return[a.y,a.x/180*Math.PI]}),b.d3.zoom.translate([b.features.diameter/2,b.features.diameter/2]),b.layers.base.attr("transform","translate("+b.features.diameter/2+","+b.features.diameter/2+")"),b.layers.nodes.on("enter",function(){this.attr("transform",function(){return"rotate("+(b.source.x0-90)+")translate("+b.source.y0+")"}),this.select("text").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?"translate(8)":"rotate(180)translate(-8)"})}),b.layers.nodes.on("merge:transition",function(){this.duration(b.features.duration).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"})}),b.layers.nodes.on("exit:transition",function(){this.attr("transform",function(){return"rotate("+(b.source.x-90)+")translate("+b.source.y+")"})})},transform:function(a){var b,c=this;return c.source=a,c.root||(c.root=a,c.root.x0=360,c.root.y0=0,b=c.d3.layout.size([360,c.features.diameter/4]).separation(function(a,b){return 0===a.depth?1:(a.parent==b.parent?1:2)/a.depth}).nodes(c.root),c.trigger("collapse:init")),b=c.d3.layout.nodes(c.root).reverse(),c.on("transform:stash",function(){b.forEach(function(a){a.x0=a.x,a.y0=a.y})}),b},diameter:function(a){return arguments.length?(this.features.diameter=a,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this.features.diameter}}),a.chart("cluster-tree.cartesian").extend("cluster.cartesian",{initialize:function(){this.d3.layout=a.layout.cluster()}}),a.chart("cluster-tree.radial").extend("cluster.radial",{initialize:function(){this.d3.layout=a.layout.cluster()}}),a.chart("cluster-tree.cartesian").extend("tree.cartesian",{initialize:function(){this.d3.layout=a.layout.tree()}}),a.chart("cluster-tree.radial").extend("tree.radial",{initialize:function(){this.d3.layout=a.layout.tree()}}),a.chart("hierarchy").extend("pack.flattened",{initialize:function(){var b=this;b.d3.layout=a.layout.pack(),b.bubble(b.features.bubble||{}),b.diameter(b.features.diameter||Math.min(b.features.width,b.features.height)),b.d3.zoom.translate([(b.features.width-b.features.diameter)/2,(b.features.height-b.features.diameter)/2]),b.layers.base.attr("transform","translate("+(b.features.width-b.features.diameter)/2+","+(b.features.height-b.features.diameter)/2+")"),b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".pack").data(a.filter(function(a){return!a.children}))},insert:function(){return this.append("g").classed("pack",!0)},events:{enter:function(){this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("circle").attr("r",function(a){return a.r}).style("fill",function(a){return b.d3.colorScale(b.features.bubble.pack(a))}),this.append("text").attr("dy",".3em").text(function(a){return a[b.features.name].substring(0,a.r/3)}),this.append("title").text(b.features.bubble.title),this.on("click",function(a){b.trigger("pack:click",a)})}}}),b.on("change:diameter",function(){b.layers.base.attr("transform","translate("+(b.features.width-b.features.diameter)/2+","+(b.features.height-b.features.diameter)/2+")")})},transform:function(a){var b=this;return b.root=a,b.d3.layout.size([b.features.diameter,b.features.diameter]).padding(1.5).nodes(b.features.bubble.flatten?b.features.bubble.flatten(a):a)},diameter:function(a){return arguments.length?(this.features.diameter=a-10,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this.features.diameter},bubble:function(b){if(!arguments.length)return this.features.bubble;var c=this;return["flatten","title","pack"].forEach(function(c){c in b&&(this[c]=a.functor(b[c]))},this.features.bubble={flatten:null,title:function(a){return a[c.features.value]},pack:function(a){return a[c.features.name]}}),c.trigger("change:formats"),c.root&&c.draw(c.root),c}}),a.chart("hierarchy").extend("pack.nested",{initialize:function(){var b=this;b.d3.layout=a.layout.pack(),b.diameter(b.features.diameter||Math.min(b.features.width,b.features.height)),b.d3.zoom.translate([(b.features.width-b.features.diameter)/2,(b.features.height-b.features.diameter)/2]),b.layers.base.attr("transform","translate("+(b.features.width-b.features.diameter)/2+","+(b.features.height-b.features.diameter)/2+")"),b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".pack").data(a)},insert:function(){return this.append("g").classed("pack",!0)},events:{enter:function(){b._initNode(this),this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("circle").attr("r",function(a){return a.r}),this.append("text"),this.on("click",function(a){b.trigger("pack:click",a)})},merge:function(){b._initNode(this),this.select("text").style("opacity",function(a){return a.r>20?1:0}).text(function(a){return a[b.features.name]})}}}),b.on("change:diameter",function(){b.layers.base.attr("transform","translate("+(b.features.width-b.features.diameter)/2+","+(b.features.height-b.features.diameter)/2+")")})},transform:function(a){var b=this;return b.root=a,b.d3.layout.size([b.features.diameter,b.features.diameter]).nodes(a)},diameter:function(a){return arguments.length?(this.features.diameter=a-10,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this.features.diameter},collapsible:function(){function b(a){var b=d.features.diameter/a.r/2;e.domain([a.x-a.r,a.x+a.r]),f.domain([a.y-a.r,a.y+a.r]);var g=d.layers.base.transition().duration(d.features.duration);g.selectAll(".pack").attr("transform",function(a){return"translate("+e(a.x)+","+f(a.y)+")"}),g.selectAll("circle").attr("r",function(a){return b*a.r}),g.selectAll("text").style("opacity",function(a){return b*a.r>20?1:0}),c=a}var c,d=this,e=a.scale.linear().range([0,d.features.diameter]),f=a.scale.linear().range([0,d.features.diameter]);return d.layers.base.on("merge",function(){c=d.root,d.on("pack:click",function(a){b(c==a?d.root:a)})}),d}}),a.chart("hierarchy").extend("partition.arc",{initialize:function(){var b=this;b.d3.layout=a.layout.partition(),b.diameter(b.features.diameter||Math.min(b.features.width,b.features.height)),b.d3.x=a.scale.linear().range([0,2*Math.PI]),b.d3.y=a.scale.sqrt().range([0,b.features.diameter/2]),b.d3.arc=a.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,b.d3.x(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,b.d3.x(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,b.d3.y(a.y))}).outerRadius(function(a){return Math.max(0,b.d3.y(a.y+a.dy))}),b.d3.zoom.translate([b.features.width/2,b.features.height/2]),b.layers.base.attr("transform","translate("+b.features.width/2+","+b.features.height/2+")"),b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll("path").data(a)},insert:function(){return this.append("path")},events:{enter:function(){this.attr("d",b.d3.arc).style("fill",function(a){return b.d3.colorScale((a.children?a:a.parent)[b.features.name])}),this.on("click",function(a){b.trigger("path:click",a)})}}}),b.on("change:radius",function(){b.layers.paths.attr("transform","translate("+b.features.width/2+","+b.features.height/2+")"),b.d3.y=a.scale.sqrt().range([0,b.features.diameter/2])})},transform:function(a){var b=this;return b.root=a,b.d3.layout.nodes(a)},diameter:function(a){return arguments.length?(this.features.diameter=a-10,this.trigger("change:radius"),this.root&&this.draw(this.root),this):this.features.diameter},collapsible:function(){function b(b){var d=a.interpolate(c.d3.x.domain(),[b.x,b.x+b.dx]),e=a.interpolate(c.d3.y.domain(),[b.y,1]),f=a.interpolate(c.d3.y.range(),[b.y?20:0,c.features.diameter/2]);return function(a,b){return b?function(){return c.d3.arc(a)}:function(b){return c.d3.x.domain(d(b)),c.d3.y.domain(e(b)).range(f(b)),c.d3.arc(a)}}}var c=this;return c.layers.base.on("merge",function(){var a=this;c.on("path:click",function(d){a.transition().duration(c.features.duration).attrTween("d",b(d))})}),c}}),a.chart("hierarchy").extend("partition.rectangle",{initialize:function(){var b=this;b.d3.layout=a.layout.partition();var c=a.scale.linear().range([0,b.features.width]),d=a.scale.linear().range([0,b.features.height]);b.d3.transform=function(a,b){return"translate(8,"+a.dx*b/2+")"},b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".partition").data(a)},insert:function(){return this.append("g").classed("partition",!0)},events:{enter:function(){b._initNode(this),this.attr("transform",function(a){return"translate("+c(a.y)+","+d(a.x)+")"});var a=b.features.width/b.root.dx,e=b.features.height/1;this.append("rect").attr("width",b.root.dy*a).attr("height",function(a){return a.dx*e}),this.append("text").attr("transform",function(a){return b.d3.transform(a,e)}).attr("dy",".35em").style("opacity",function(a){return a.dx*e>12?1:0}).text(function(a){return a[b.features.name]}),this.on("click",function(a){b.trigger("rect:click",a)})}}})},transform:function(a){var b=this;return b.root=a,b.d3.layout.nodes(a)},collapsible:function(){function b(a){var b=(a.y?d.features.width-40:d.features.width)/(1-a.y),g=d.features.height/a.dx;e.domain([a.y,1]).range([a.y?40:0,d.features.width]),f.domain([a.x,a.x+a.dx]);var h=d.layers.base.transition().duration(d.features.duration);h.selectAll(".partition").attr("transform",function(a){return"translate("+e(a.y)+","+f(a.x)+")"}),h.selectAll("rect").attr("width",a.dy*b).attr("height",function(a){return a.dx*g}),h.selectAll("text").attr("transform",function(a){return d.d3.transform(a,g)}).style("opacity",function(a){return a.dx*g>12?1:0}),c=a}var c,d=this,e=a.scale.linear(),f=a.scale.linear().range([0,d.features.height]);return d.layers.base.on("merge",function(){c=d.root,d.on("rect:click",function(a){b(c==a?d.root:a)})}),d}}),a.chart("hierarchy").extend("treemap",{initialize:function(){var b=this;b.d3.layout=a.layout.treemap(),b.layer("base",b.layers.base,{dataBind:function(a){return this.selectAll(".cell").data(a)},insert:function(){return this.append("g").classed("cell",!0)},events:{enter:function(){this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("rect").attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("fill",function(a){return a.parent?b.d3.colorScale(a.parent[b.features.name]):null}),this.append("text").attr("x",function(a){return a.dx/2}).attr("y",function(a){return a.dy/2}).attr("dy",".35em").text(function(a){return a.children?null:a[b.features.name]}).style("opacity",function(a){return a.w=this.getComputedTextLength(),a.dx>a.w?1:0}),this.on("click",function(a){b.trigger("rect:click",a)})}}})},transform:function(a){var b=this;return b.root=a,b.d3.layout.round(!1).size([b.features.width,b.features.height]).sticky(!0).nodes(a)},collapsible:function(){function b(a){var b=d.features.width/a.dx,g=d.features.height/a.dy;e.domain([a.x,a.x+a.dx]),f.domain([a.y,a.y+a.dy]);var h=d.layers.base.transition().duration(d.features.duration);h.selectAll(".cell").attr("transform",function(a){return"translate("+e(a.x)+","+f(a.y)+")"}),h.selectAll("rect").attr("width",function(a){return b*a.dx}).attr("height",function(a){return g*a.dy}),h.selectAll("text").attr("x",function(a){return b*a.dx/2}).attr("y",function(a){return g*a.dy/2}).style("opacity",function(a){return b*a.dx>a.w?1:0}),c=a}var c,d=this,e=a.scale.linear().range([0,d.features.width]),f=a.scale.linear().range([0,d.features.height]);return d.layers.base.on("merge",function(){c=d.root,d.on("rect:click",function(a){b(c==a.parent?d.root:a.parent)})}),d}})}(window.d3);