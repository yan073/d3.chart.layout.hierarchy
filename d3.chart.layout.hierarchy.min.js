!function(a,b){"use strict";"function"==typeof a.define&&a.define.amd?define(["d3"],function(c){b(a,c)}):b(a,a.d3)}(this,function(a,b){"use strict";b.chart("hierarchy",{initialize:function(){var a=this;a.d3={},a.layers={},a.options={},a.base.attr("width",a.base.node().parentNode.clientWidth),a.base.attr("height",a.base.node().parentNode.clientHeight),a.options.width=a.base.attr("width"),a.options.height=a.base.attr("height"),a.d3.colorScale=a.options.colors?b.scale.ordinal().range(a.options.colors):b.scale.category20c(),a.d3.zoom=b.behavior.zoom(),a.layers.base=a.base.append("g"),a.name(a.options.name||"name"),a.value(a.options.value||"value"),a.duration(a.options.duration||750),a._internalUpdate=!1,a.off("change:value").on("change:value",function(){a.d3.layout.value(function(b){return"_COUNT_"===a.options.value?1:b[a.options.value]})}),a.off("change:colors").on("change:colors",function(){a.d3.colorScale=b.scale.ordinal().range(a.options.colors)})},transform:function(a){var b=this;return b._internalUpdate||b._walker(b.root,function(a){a.isLeaf=!a.children&&!a._children},function(a){return a.children&&a.children.length>0?a.children:a._children&&a._children.length>0?a._children:null}),a},name:function(a){var b=this;return arguments.length?(b.options.name=a,b.trigger("change:name"),b.root&&b.draw(b.root),b):b.options.name},value:function(a){var b=this;return arguments.length?(b.options.value=a,b.trigger("change:value"),b.root&&b.draw(b.root),b):b.options.value},colors:function(a){var b=this;return arguments.length?(b.options.colors=a,b.trigger("change:colors"),b.root&&b.draw(b.root),b):b.options.colors},duration:function(a){var b=this;return arguments.length?(b.options.duration=a,b.trigger("change:duration"),b.root&&b.draw(b.root),b):b.options.duration},sortable:function(a){var c=this;return c.d3.layout.sort("_ASC_"===a?function(a,d){return b.ascending(a[c.options.name],d[c.options.name])}:"_DESC_"===a?function(a,d){return b.descending(a[c.options.name],d[c.options.name])}:a),c},zoomable:function(a){function c(){d.layers.base.attr("transform","translate("+b.event.translate+") scale("+b.event.scale+")")}var d=this,e=a||[0,1/0];return d.base.call(d.d3.zoom.scaleExtent(e).on("zoom",c)),d},_walker:function(a,b,c){if(a){b(a);var d=c(a);if(d)for(var e=d.length,f=0;e>f;f++)this._walker(d[f],b,c)}}}),b.chart("hierarchy").extend("cluster-tree",{initialize:function(){var a=this,b=0;a.radius(a.options.radius||4.5),a.levelGap(a.options.levelGap||"auto"),a.layers.links=a.layers.base.append("g").classed("links",!0),a.layers.nodes=a.layers.base.append("g").classed("nodes",!0),a.layer("nodes",a.layers.nodes,{dataBind:function(a){return this.selectAll(".node").data(a,function(a){return a._id||(a._id=++b)})},insert:function(){return this.append("g").classed("node",!0)},events:{enter:function(){this.classed("leaf",function(a){return a.isLeaf}),this.append("circle").attr("r",0),this.append("text").attr("dy",".35em").text(function(b){return b[a.options.name]}).style("fill-opacity",0),this.on("click",function(b){a.trigger("click:node",b)})},"merge:transition":function(){this.select("circle").attr().attr("r",a.options.radius),this.select("text").style("fill-opacity",1)},"exit:transition":function(){this.duration(a.options.duration).remove(),this.select("circle").attr("r",0),this.select("text").style("fill-opacity",0)}}}),a.layer("links",a.layers.links,{dataBind:function(b){return this.selectAll(".link").data(a.d3.layout.links(b),function(a){return a.target._id})},insert:function(){return this.append("path").classed("link",!0)},events:{enter:function(){this.attr("d",function(){var b={x:a.source.x0,y:a.source.y0};return a.d3.diagonal({source:b,target:b})})},"merge:transition":function(){this.duration(a.options.duration).attr("d",a.d3.diagonal)},"exit:transition":function(){this.duration(a.options.duration).attr("d",function(){var b={x:a.source.x,y:a.source.y};return a.d3.diagonal({source:b,target:b})}).remove()}}})},transform:function(a){var b=this;return b._internalUpdate||b.trigger("init:collapsible",a),a=b.d3.layout.nodes(b.root),b.options.levelGap&&"auto"!==b.options.levelGap&&a.forEach(function(a){a.y=a.depth*b.options.levelGap}),b.off("transform:stash").on("transform:stash",function(){a.forEach(function(a){a.x0=a.x,a.y0=a.y})}),a},radius:function(a){var b=this;return arguments.length?(b.options.radius="_COUNT_"===a?function(a){return a._children?a._children.length:a.children?a.children.length:1}:a,b.trigger("change:radius"),b.root&&b.draw(b.root),b):b.options.radius},levelGap:function(a){var b=this;return arguments.length?(b.options.levelGap=a,b.trigger("change:levelGap"),b.root&&b.draw(b.root),b):b.options.levelGap},collapsible:function(a){function b(a){return a.children?(a._children=a.children,a.children=null):a._children&&(a.children=a._children,a._children=null),a}function c(a){a.children&&(a._children=a.children,a._children.forEach(c),a.children=null)}var d=this,e=a;return d.off("init:collapsible").on("init:collapsible",function(a){void 0!==e&&a.forEach(function(a){a.depth==e&&c(a)})}),d.off("click:node").on("click:node",function(a){a=b(a),d.trigger("transform:stash"),d._internalUpdate=!0,d.draw(a),d._internalUpdate=!1}),d}}),b.chart("cluster-tree").extend("cluster-tree.cartesian",{initialize:function(){var a=this;a.margin(a.options.margin||{}),a.d3.diagonal=b.svg.diagonal().projection(function(a){return[a.y,a.x]}),a.layers.nodes.on("enter",function(){this.attr("transform",function(){return"translate("+a.source.y0+","+a.source.x0+")"}),this.select("text").attr("x",function(a){return a.isLeaf?10:-10}).attr("text-anchor",function(a){return a.isLeaf?"start":"end"})}),a.layers.nodes.on("merge:transition",function(){this.duration(a.options.duration).attr("transform",function(a){return"translate("+a.y+","+a.x+")"})}),a.layers.nodes.on("exit:transition",function(){this.attr("transform",function(){return"translate("+a.source.y+","+a.source.x+")"})}),a.off("change:margin").on("change:margin",function(){a.options.width=a.base.attr("width")-a.options.margin.left-a.options.margin.right,a.options.height=a.base.attr("height")-a.options.margin.top-a.options.margin.bottom,a.layers.base.attr("transform","translate("+a.options.margin.left+","+a.options.margin.top+")")})},transform:function(a){var b=this;return b.source=a,b._internalUpdate||(b.root=a,b.root.x0=b.options.height/2,b.root.y0=0),b.d3.layout.size([b.options.height,b.options.width]).nodes(b.root)},margin:function(a){var b=this;return arguments.length?(["top","right","bottom","left"].forEach(function(b){b in a&&(this[b]=a[b])},b.options.margin={top:0,right:0,bottom:0,left:0}),b.trigger("change:margin"),b.root&&b.draw(b.root),b):b.options.margin}}),b.chart("cluster-tree").extend("cluster-tree.radial",{initialize:function(){var a=this;a.diameter(a.options.diameter||Math.min(a.options.width,a.options.height)),a.d3.diagonal=b.svg.diagonal.radial().projection(function(a){return[a.y,a.x/180*Math.PI]}),a.d3.zoom.translate([a.options.diameter/2,a.options.diameter/2]),a.layers.base.attr("transform","translate("+a.options.diameter/2+","+a.options.diameter/2+")"),a.layers.nodes.on("enter",function(){this.attr("transform",function(){return"rotate("+(a.source.x0-90)+")translate("+a.source.y0+")"}),this.select("text").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?"translate(8)":"rotate(180)translate(-8)"})}),a.layers.nodes.on("merge:transition",function(){this.duration(a.options.duration).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"})}),a.layers.nodes.on("exit:transition",function(){this.attr("transform",function(){return"rotate("+(a.source.x-90)+")translate("+a.source.y+")"})})},transform:function(a){var b=this;return b.source=a,b._internalUpdate||(b.root=a,b.root.x0=360,b.root.y0=0),b.d3.layout.size([360,b.options.diameter/4]).separation(function(a,b){return 0===a.depth?1:(a.parent==b.parent?1:2)/a.depth}).nodes(b.root)},diameter:function(a){var b=this;return arguments.length?(b.options.diameter=a,b.trigger("change:diameter"),b.root&&b.draw(b.root),b):b.options.diameter}}),b.chart("cluster-tree.cartesian").extend("cluster.cartesian",{initialize:function(){this.d3.layout=b.layout.cluster()}}),b.chart("cluster-tree.radial").extend("cluster.radial",{initialize:function(){this.d3.layout=b.layout.cluster()}}),b.chart("cluster-tree.cartesian").extend("tree.cartesian",{initialize:function(){this.d3.layout=b.layout.tree()}}),b.chart("cluster-tree.radial").extend("tree.radial",{initialize:function(){this.d3.layout=b.layout.tree()}}),b.chart("hierarchy").extend("pack.flattened",{initialize:function(){var a=this;a.d3.layout=b.layout.pack(),a.bubble(a.options.bubble||{}),a.diameter(a.options.diameter||Math.min(a.options.width,a.options.height)),a.d3.zoom.translate([(a.options.width-a.options.diameter)/2,(a.options.height-a.options.diameter)/2]),a.layers.base.attr("transform","translate("+(a.options.width-a.options.diameter)/2+","+(a.options.height-a.options.diameter)/2+")"),a.layer("base",a.layers.base,{dataBind:function(a){return this.selectAll(".pack").data(a.filter(function(a){return!a.children}))},insert:function(){return this.append("g").classed("pack",!0)},events:{enter:function(){this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("circle").attr("r",function(a){return a.r}).style("fill",function(b){return a.d3.colorScale(a.options.bubble.pack(b))}),this.append("text").attr("dy",".3em").text(function(b){return b[a.options.name].substring(0,b.r/3)}),this.append("title").text(a.options.bubble.title),this.on("click",function(b){a.trigger("pack:click",b)})}}}),a.off("change:diameter").on("change:diameter",function(){a.layers.base.attr("transform","translate("+(a.options.width-a.options.diameter)/2+","+(a.options.height-a.options.diameter)/2+")")})},transform:function(a){var b=this;return b.root=a,b.d3.layout.size([b.options.diameter,b.options.diameter]).padding(1.5).nodes(b.options.bubble.flatten?b.options.bubble.flatten(a):a)},diameter:function(a){var b=this;return arguments.length?(b.options.diameter=a-10,b.trigger("change:diameter"),b.root&&b.draw(b.root),b):b.options.diameter},bubble:function(a){var c=this;return arguments.length?(["flatten","title","pack"].forEach(function(c){c in a&&(this[c]=b.functor(a[c]))},c.options.bubble={flatten:null,title:function(a){return a[c.options.value]},pack:function(a){return a[c.options.name]}}),c.trigger("change:formats"),c.root&&c.draw(c.root),c):c.options.bubble}}),b.chart("hierarchy").extend("pack.nested",{initialize:function(){var a=this;a.d3.layout=b.layout.pack(),a.diameter(a.options.diameter||Math.min(a.options.width,a.options.height)),a.d3.zoom.translate([(a.options.width-a.options.diameter)/2,(a.options.height-a.options.diameter)/2]),a.layers.base.attr("transform","translate("+(a.options.width-a.options.diameter)/2+","+(a.options.height-a.options.diameter)/2+")"),a.layer("base",a.layers.base,{dataBind:function(a){return this.selectAll(".pack").data(a)},insert:function(){return this.append("g").classed("pack",!0)},events:{enter:function(){this.classed("leaf",function(a){return a.isLeaf}),this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("circle").attr("r",function(a){return a.r}),this.append("text"),this.on("click",function(b){a.trigger("click:pack",b)})},merge:function(){this.select("text").style("opacity",function(a){return a.r>20?1:0}).text(function(b){return b[a.options.name]})}}}),a.off("change:diameter").on("change:diameter",function(){a.layers.base.attr("transform","translate("+(a.options.width-a.options.diameter)/2+","+(a.options.height-a.options.diameter)/2+")")})},transform:function(a){var b=this;return b.root=a,b.d3.layout.size([b.options.diameter,b.options.diameter]).nodes(a)},diameter:function(a){var b=this;return arguments.length?(b.options.diameter=a-10,b.trigger("change:diameter"),b.root&&b.draw(b.root),b):b.options.diameter},collapsible:function(){function a(a){var b=d.options.diameter/a.r/2;e.domain([a.x-a.r,a.x+a.r]),f.domain([a.y-a.r,a.y+a.r]);var g=d.layers.base.transition().duration(d.options.duration);g.selectAll(".pack").attr("transform",function(a){return"translate("+e(a.x)+","+f(a.y)+")"}),g.selectAll("circle").attr("r",function(a){return b*a.r}),g.selectAll("text").style("opacity",function(a){return b*a.r>20?1:0}),c=a}var c,d=this,e=b.scale.linear().range([0,d.options.diameter]),f=b.scale.linear().range([0,d.options.diameter]);return d.layers.base.on("merge",function(){c=d.root,d.off("click:pack").on("click:pack",function(b){a(c==b?d.root:b)})}),d}}),b.chart("hierarchy").extend("partition.arc",{initialize:function(){var a=this;a.d3.layout=b.layout.partition(),a.diameter(a.options.diameter||Math.min(a.options.width,a.options.height)),a.d3.x=b.scale.linear().range([0,2*Math.PI]),a.d3.y=b.scale.sqrt().range([0,a.options.diameter/2]),a.d3.arc=b.svg.arc().startAngle(function(b){return Math.max(0,Math.min(2*Math.PI,a.d3.x(b.x)))}).endAngle(function(b){return Math.max(0,Math.min(2*Math.PI,a.d3.x(b.x+b.dx)))}).innerRadius(function(b){return Math.max(0,a.d3.y(b.y))}).outerRadius(function(b){return Math.max(0,a.d3.y(b.y+b.dy))}),a.d3.zoom.translate([a.options.width/2,a.options.height/2]),a.layers.base.attr("transform","translate("+a.options.width/2+","+a.options.height/2+")"),a.layer("base",a.layers.base,{dataBind:function(a){return this.selectAll("path").data(a)},insert:function(){return this.append("path")},events:{enter:function(){this.classed("leaf",function(a){return a.isLeaf}),this.attr("d",a.d3.arc).style("fill",function(b){return a.d3.colorScale((b.children?b:b.parent)[a.options.name])}),this.on("click",function(b){a.trigger("click:path",b)})}}}),a.off("change:radius").on("change:radius",function(){a.layers.paths.attr("transform","translate("+a.options.width/2+","+a.options.height/2+")"),a.d3.y=b.scale.sqrt().range([0,a.options.diameter/2])})},transform:function(a){var b=this;return b.root=a,b.d3.layout.nodes(a)},diameter:function(a){var b=this;return arguments.length?(b.options.diameter=a-10,b.trigger("change:radius"),b.root&&b.draw(b.root),b):b.options.diameter},collapsible:function(){function a(a){var d=b.interpolate(c.d3.x.domain(),[a.x,a.x+a.dx]),e=b.interpolate(c.d3.y.domain(),[a.y,1]),f=b.interpolate(c.d3.y.range(),[a.y?20:0,c.options.diameter/2]);return function(a,b){return b?function(){return c.d3.arc(a)}:function(b){return c.d3.x.domain(d(b)),c.d3.y.domain(e(b)).range(f(b)),c.d3.arc(a)}}}var c=this;return c.layers.base.on("merge",function(){var b=this;c.off("click:path").on("click:path",function(d){b.transition().duration(c.options.duration).attrTween("d",a(d))})}),c}}),b.chart("hierarchy").extend("partition.rectangle",{initialize:function(){var a=this;a.d3.layout=b.layout.partition();var c=b.scale.linear().range([0,a.options.width]),d=b.scale.linear().range([0,a.options.height]);a.d3.transform=function(a,b){return"translate(8,"+a.dx*b/2+")"},a.layer("base",a.layers.base,{dataBind:function(a){return this.selectAll(".partition").data(a)},insert:function(){return this.append("g").classed("partition",!0)},events:{enter:function(){this.classed("leaf",function(a){return a.isLeaf}),this.attr("transform",function(a){return"translate("+c(a.y)+","+d(a.x)+")"});var b=a.options.width/a.root.dx,e=a.options.height/1;this.append("rect").attr("width",a.root.dy*b).attr("height",function(a){return a.dx*e}),this.append("text").attr("transform",function(b){return a.d3.transform(b,e)}).attr("dy",".35em").style("opacity",function(a){return a.dx*e>12?1:0}).text(function(b){return b[a.options.name]}),this.on("click",function(b){a.trigger("click:rect",b)})}}})},transform:function(a){var b=this;return b.root=a,b.d3.layout.nodes(a)},collapsible:function(){function a(a){var b=(a.y?d.options.width-40:d.options.width)/(1-a.y),g=d.options.height/a.dx;e.domain([a.y,1]).range([a.y?40:0,d.options.width]),f.domain([a.x,a.x+a.dx]);var h=d.layers.base.transition().duration(d.options.duration);h.selectAll(".partition").attr("transform",function(a){return"translate("+e(a.y)+","+f(a.x)+")"}),h.selectAll("rect").attr("width",a.dy*b).attr("height",function(a){return a.dx*g}),h.selectAll("text").attr("transform",function(a){return d.d3.transform(a,g)}).style("opacity",function(a){return a.dx*g>12?1:0}),c=a}var c,d=this,e=b.scale.linear(),f=b.scale.linear().range([0,d.options.height]);return d.layers.base.on("merge",function(){c=d.root,d.off("click:rect").on("click:rect",function(b){a(c==b?d.root:b)})}),d}}),b.chart("hierarchy").extend("treemap",{initialize:function(){var a=this;a.d3.layout=b.layout.treemap(),a.layer("base",a.layers.base,{dataBind:function(a){return this.selectAll(".cell").data(a)},insert:function(){return this.append("g").classed("cell",!0)},events:{enter:function(){this.classed("leaf",function(a){return a.isLeaf}),this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("rect").attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("fill",function(b){return b.parent?a.d3.colorScale(b.parent[a.options.name]):null}),this.append("text").attr("x",function(a){return a.dx/2}).attr("y",function(a){return a.dy/2}).attr("dy",".35em").text(function(b){return b.children?null:b[a.options.name]}).style("opacity",function(a){return a.w=this.getComputedTextLength(),a.dx>a.w?1:0}),this.on("click",function(b){a.trigger("click:rect",b)})}}})},transform:function(a){var b=this;return b.root=a,b.d3.layout.round(!1).size([b.options.width,b.options.height]).sticky(!0).nodes(a)},collapsible:function(){function a(a){var b=d.options.width/a.dx,g=d.options.height/a.dy;e.domain([a.x,a.x+a.dx]),f.domain([a.y,a.y+a.dy]);var h=d.layers.base.transition().duration(d.options.duration);h.selectAll(".cell").attr("transform",function(a){return"translate("+e(a.x)+","+f(a.y)+")"}),h.selectAll("rect").attr("width",function(a){return b*a.dx}).attr("height",function(a){return g*a.dy}),h.selectAll("text").attr("x",function(a){return b*a.dx/2}).attr("y",function(a){return g*a.dy/2}).style("opacity",function(a){return b*a.dx>a.w?1:0}),c=a}var c,d=this,e=b.scale.linear().range([0,d.options.width]),f=b.scale.linear().range([0,d.options.height]);return d.layers.base.on("merge",function(){c=d.root,d.off("click:rect").on("click:rect",function(b){a(c==b.parent?d.root:b.parent)})}),d}})});